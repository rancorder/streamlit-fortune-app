import streamlit as st
import google.generativeai as genai
import os

# ğŸ”¹ Streamlit Cloud ã® Secrets ã‹ã‚‰ APIã‚­ãƒ¼ ã‚’å–å¾—
API_KEY = st.secrets["GEMINI_API_KEY"]

# APIã‚­ãƒ¼ã®è¨­å®š
if not API_KEY:
    st.error("âš  APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Streamlit Cloud ã® Secrets ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
else:
    genai.configure(api_key=API_KEY)

# ğŸ”¹ Gemini API ãƒ¢ãƒ‡ãƒ«ã®é¸æŠï¼ˆãƒ¢ãƒ‡ãƒ«åã‚’å¤‰æ›´ã—ã¦è©¦ã™ï¼‰
MODEL_NAME = "gemini-1.5-pro"  # ã‚‚ã—ãã¯ "gemini-pro"

# ğŸ”¹ å ã„ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå››æŸ±æ¨å‘½ãƒ»å…­æ˜Ÿå è¡“ãƒ»å¤©æ˜Ÿè¡“ã‚’çµ±åˆï¼‰
def generate_fortune(birth_date, gender):
    prompt = f"""
    ã‚ãªãŸã¯ãƒ—ãƒ­ã®å ã„å¸«ã§ã™ã€‚
    ä»¥ä¸‹ã®å è¡“ã‚’çµ„ã¿åˆã‚ã›ã¦ã€{birth_date} ç”Ÿã¾ã‚Œã® {gender} ã®é‹å‹¢ã‚’è©³ç´°ã«å ã£ã¦ãã ã•ã„ã€‚

    1ï¸âƒ£ **å››æŸ±æ¨å‘½**: ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰å‘½å¼ã‚’åˆ†æã—ã€ãã®äººã®åŸºæœ¬çš„ãªæ€§æ ¼ã‚„é‹å‹¢ã®æµã‚Œã‚’èª¬æ˜ã€‚
    2ï¸âƒ£ **å…­æ˜Ÿå è¡“**: ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰é‹å‘½æ˜Ÿã‚’å°ãã€é‹æ°—ã®æµã‚Œï¼ˆå¥½èª¿æœŸãƒ»ä½è¿·æœŸï¼‰ã‚’è¨ºæ–­ã€‚
    3ï¸âƒ£ **å¤©æ˜Ÿè¡“**: ç”Ÿå¹´æœˆæ—¥ã‚’åŸºã«ã€12ç¨®é¡ã®å¤©æ˜Ÿã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®šã—ã€é©æ€§ã‚„äººé–“é–¢ä¿‚ã‚’ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€‚

    **é‘‘å®šçµæœã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
    - **ç·åˆé‹:** â—‹â—‹ãªé‹å‹¢ã§ã™ã€‚
    - **ä»•äº‹é‹:** â—‹â—‹ãªå‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚
    - **æ‹æ„›é‹:** â—‹â—‹ãªç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚
    - **é‡‘é‹:** â—‹â—‹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
    - **å¥åº·é‹:** â—‹â—‹ã«æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚
    - **ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼:** â—‹â—‹
    - **ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ :** â—‹â—‹

    âš  **å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’200æ–‡å­—ä»¥å†…ã§ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚**
    """

    try:
        model = genai.GenerativeModel(MODEL_NAME)
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"âš  ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}"

# ğŸ¨ **Streamlit Web ã‚¢ãƒ—ãƒª**
st.title("ğŸ”® æœ¬æ ¼å ã„ã‚¢ãƒ—ãƒª ğŸ”®")

# ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
birth_date = st.text_input("ç”Ÿå¹´æœˆæ—¥ã‚’ YYYYMMDD ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„", "")
gender_option = st.radio("æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„", ("ç”·æ€§", "å¥³æ€§"))

# ğŸ”˜ å ã„ãƒœã‚¿ãƒ³
if st.button("ä»Šæ—¥ã®é‹å‹¢ã‚’å ã†"):
    if birth_date.isdigit() and len(birth_date) == 8:
        fortune = generate_fortune(birth_date, gender_option)
        st.subheader("âœ¨ ä»Šæ—¥ã®é‹å‹¢ âœ¨")
        st.write(fortune)
    else:
        st.error("âš  8æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ (ä¾‹: 19900515)")
